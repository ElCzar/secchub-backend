# ==============================================================================
# SECCHUB BACKEND APPLICATION CONFIGURATION
# ==============================================================================
# This configuration file contains settings for the SecHub Backend application.
# Environment variables can be used to override default values for security.
# ==============================================================================

spring:
    application:
        name: secchub-backend

    # ==============================================================================
    # DATABASE CONFIGURATION
    # ==============================================================================
    # WARNING: Never commit database credentials to version control
    # Default credentials are for development only
    # Environment variables:
    #   DB_URL: Database connection URL
    #   DB_USERNAME: Database username
    #   DB_PASSWORD: Database password
    # ==============================================================================
    datasource:
        url: ${DB_URL:jdbc:mysql://localhost:3306/secchub} # WARNING: Change default URL in production
        username: ${DB_USERNAME:user}  # WARNING: Change default username in production
        password: ${DB_PASSWORD:password}  # WARNING: Change default password in production
        driver-class-name: com.mysql.cj.jdbc.Driver
        hikari:
            connection-timeout: 30000       # 30 seconds timeout for database connections
            maximum-pool-size: 10           # Maximum number of connections in the pool
            idle-timeout: 300000            # 5 minutes before an idle connection is removed
            max-lifetime: 1200000           # 20 minutes maximum lifetime for a connection
            connection-test-query: SELECT 1 # Simple query to test connection validity
    # ==============================================================================
    # SPRING EMAIL CONFIGURATION
    # ==============================================================================
    # Use environment variables MAIL_USERNAME and MAIL_PASSWORD for security
    # For Gmail, use App Passwords instead of regular passwords
    # ==============================================================================
    mail:
        host: ${MAIL_HOST:smtp.gmail.com}
        port: ${MAIL_PORT:587}
        username: ${MAIL_USERNAME:username}
        password: ${MAIL_PASSWORD:password}
        properties:
            mail:
                transport:
                    protocol: smtp
                smtp:
                    auth: true
                    starttls:
                        enable: true
                    ssl:
                        trust: "*"
                debug: false

# ==============================================================================
# JWT SECURITY CONFIGURATION
# ==============================================================================
# CRITICAL: JWT secret must be changed in production environment!
# Use a cryptographically secure random key of at least 512 bits
# Environment variables:
#   JWT_SECRET: JWT secret key
#   JWT_EXPIRATION: JWT expiration time
#   JWT_REFRESH_EXPIRATION: JWT refresh token expiration time
#   JWT_ISSUER: JWT issuer
# ==============================================================================
jwt:
    # WARNING: This is a default secret key for development only!
    # MUST be overridden in production using JWT_SECRET environment variable
    secret: ${JWT_SECRET:TXlTZWNyZXRLZXlGb3JKV1RUb2tlbkdlbmVyYXRpb25UaGF0SXNBdExlYXN0MzJDaGFyYWN0ZXJzTG9uZ0ZvclNIQTI1Ng==}
    
    # Token expiration time in milliseconds (default: 24 hours)
    # INFO: 86400000ms = 24 hours, adjust based on security requirements
    expiration-ms: ${JWT_EXPIRATION:86400000}

    # Refresh token expiration time in milliseconds (default: 30 days)
    # INFO: 604800000ms = 7 days, adjust based on security requirements
    refresh-expiration-ms: ${JWT_REFRESH_EXPIRATION:604800000}

    # JWT issuer claim - identifies who issued the token
    # INFO: Should match domain in production
    issuer: ${JWT_ISSUER:secchub.javeriana.edu.co}

# ==============================================================================
# SERVER CONFIGURATION
# ==============================================================================
server:
    port: 8080  # INFO: Application will run on this port
    servlet:
        context-path: /v1  # INFO: Base path for all API endpoints

# ==============================================================================
# LOGGING CONFIGURATION
# ==============================================================================
# INFO: Logging levels configured for development environment can be DEBUG
# WARNING: DEBUG and TRACE levels may expose sensitive information in logs
# Consider using INFO or WARN levels in production
# ==============================================================================
logging:
    level:
        # Application-specific logging
        "[co.edu.puj.secchub_backend]": INFO
        
        # Spring Security logging - useful for debugging authentication issues
        "[org.springframework.security]": INFO

        # Web request logging
        "[org.springframework.web]": INFO

        # Database logging
        "[org.hibernate]": INFO                                   # INFO: Shows Hibernate logs
        "[org.hibernate.SQL]": DEBUG                              # INFO: Shows SQL queries executed
        "[org.hibernate.type.descriptor.sql.BasicBinder]": TRACE  # WARNING: Shows SQL parameters

    # Console output pattern with colors
    pattern:
        console: "%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr(${LOG_LEVEL_PATTERN:-%5p}) %clr(${PID:- }){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}"
        
        # File output pattern
        file: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"

    # Log file configuration
    file:
        name: logs/secchub-backend.log  # INFO: Logs will be written to this file